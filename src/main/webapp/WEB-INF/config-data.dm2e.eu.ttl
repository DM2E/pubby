# Pubby Example Configuration
#
# This configuration connects to the DBpedia SPARQL endpoint and
# re-publishes on your local machine, with dereferenceable
# localhost URIs.
#
# This assumes you already have a servlet container running
# on your machine at http://localhost:8080/ .
#
# Install Pubby as the root webapp of your servlet container,
# and make sure the config-file parameter in Pubby's web.xml
# points to this configuration file.
#
# Then browse to http://localhost:8080/ .

# Prefix declarations to be used in RDF output
@prefix conf: <http://richard.cyganiak.de/2007/pubby/config.rdf#> .
@prefix meta: <http://example.org/metadata#> .
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix owl: <http://www.w3.org/2002/07/owl#> .
@prefix dc: <http://purl.org/dc/elements/1.1/> .
@prefix dcterms: <http://purl.org/dc/terms/> .
@prefix foaf: <http://xmlns.com/foaf/0.1/> .
@prefix skos: <http://www.w3.org/2004/02/skos/core#> .
@prefix geo: <http://www.w3.org/2003/01/geo/wgs84_pos#> .
@prefix dbpedia: <http://localhost:8080/resource/> .
@prefix p: <http://localhost:8080/property/> .
@prefix yago: <http://localhost:8080/class/yago/> .
@prefix units: <http://dbpedia.org/units/> .
@prefix geonames: <http://www.geonames.org/ontology#> .
@prefix prv:      <http://purl.org/net/provenance/ns#> .
@prefix prvTypes: <http://purl.org/net/provenance/types#> .
@prefix doap:     <http://usefulinc.com/ns/doap#> .
@prefix void:     <http://rdfs.org/ns/void#> .
@prefix ir:       <http://www.ontologydesignpatterns.org/cp/owl/informationrealization.owl#> .
@prefix edm: <http://www.europeana.eu/schemas/edm/> .
@prefix ore: <http://www.openarchives.org/ore/terms/> .
@prefix wgs84: <http://www.w3.org/2003/01/geo/wgs84_pos#> .
@prefix xalan: <http://xml.apache.org/xalan> .
@prefix tei2edm: <http://sbb.spk-berlin.de/dm2e/tei2edm> .
@prefix dm2e11: <http://onto.dm2e.eu/schemas/dm2e/1.1/> .
@prefix dm2e: <http://onto.dm2e.eu/schemas/dm2e/> .
@prefix omnom: <http://onto.dm2e.eu/omnom/> .
@prefix omnom_types: <http://onto.dm2e.eu/omnom-types/> .
@prefix dct: <http://purl.org/dc/terms/> .
@prefix bibo: <http://purl.org/ontology/bibo/> .
@prefix pro: <http://purl.org/spar/pro/> .
@prefix prov: <http://www.w3.org/ns/prov#> .
@prefix dm2e_unofficial: <http://onto.dm2e.eu/UNOFFICIAL/> .
@prefix rdaGr2: <http://rdvocab.info/ElementsGr2/> .
@prefix crm: <http://www.cidoc-crm.org/cidoc-crm/> .


# Server configuration section
<> a conf:Configuration;
    # Project name for display in page titles
    conf:projectName "DM2E (Direct Ingestion Test)";
    # Homepage with description of the project for the link in the page header
    conf:projectHomepage <http://dm2e.eu>;
    # The Pubby root, where the webapp is running inside the servlet container.
    # Recommended. If not available, automatic detection is used.
    # conf:webBase <http://data.dm2e.eu/data/>;
    # URL of an RDF file whose prefix mapping is to be used by the
    # server; defaults to <>, which is *this* file.
    # conf:usePrefixesFrom <http://lelystad.informatik.uni-mannheim.de:8080/prefixes.n3>;
    # conf:usePrefixesFrom <https://dl.dropbox.com/u/14362931/DM2E/prefixes.n3>;
    # If labels and descriptions are available in multiple languages,
    # prefer this one.
    conf:defaultLanguage "en";
    # When the homepage of the server is accessed, this resource will
    # be shown.
    conf:indexResource <http://data.dm2e.eu/data/list>;
    conf:labelProperty rdfs:label, dc:title, dc:identifier;
    conf:imageProperty <http://www.europeana.eu/schemas/edm/object>;
    conf:showLabels "false";
    conf:loadVocabularyFromURL
        <https://dm2e.hu-berlin.de/onto/neologism/schemas/dm2e/1.0.rdf>,
        <http://www.openarchives.org/ore/1.0/terms>,
        <http://dublincore.org/2012/06/14/dcelements.rdf>;
#    conf:loadVocabularyFromFile
#        "";
    conf:defaultEndpoint <http://localhost:19997/dm2e-direct/sparql>;



# List of Collections
#
    conf:dataset [
        # SPARQL endpoint URL of the dataset
        conf:sparqlEndpoint "default";
        # Default graph name to query (not necessary for most endpoints)
        # conf:sparqlDefaultGraph <http://141.20.126.155/api/file/50b8c6d228f37c3d62000007/data>;
        # Common URI prefix of all resource URIs in the SPARQL dataset
        conf:datasetBase <http://data.dm2e.eu/data/list>;
        conf:priority "1";
        conf:addSameAsStatements "false";
        # Will be appended to the conf:webBase to form the public
        # resource URIs; if not present, defaults to ""
        conf:webResourcePrefix "list";
        # conf:customRedirect "de.fuberlin.wiwiss.pubby.dm2e.ResourceRedirector";
        # Will be appended to the conf:webBase to form the public
        # data URIs; if not present, defaults to "data/"
        conf:webDataPrefix "rdf/list";
        # Will be appended to the conf:webBase to form the public
        # page URIs; if not present, defaults to "page/"
        conf:webPagePrefix "html/list";

        conf:useSparqlMapping [
                    conf:uriPattern "http://data.dm2e.eu/data/list";
                    conf:sparqlQuery '''
                    CONSTRUCT {
                         <http://data.dm2e.eu/data/list> a <http://onto.dm2e.eu/schemas/dm2e/AbstractDatasetSet> .
                        <http://data.dm2e.eu/data/list> <http://onto.dm2e.eu/schemas/dm2e/hasAbstractDataset> ?s .
                    } WHERE {
                        graph ?g {
                            ?x <http://www.w3.org/ns/prov#specializationOf> ?s .
                            FILTER (?s != <http://data.dm2e.eu/data/dataset/bbaw/dta>)
                        }
                    }
                    ''';
                    conf:publishResources
                        "http://data.dm2e.eu/data/list";
                    conf:primaryResource
                        "http://data.dm2e.eu/data/list";
                ];

        # Fixes an issue with the server running behind an Apache proxy;
        # can be ignored otherwise
        conf:fixUnescapedCharacters "(),'!$&*+;=@";

        # include metadata
        conf:metadataTemplate "metadata.ttl";

    ];





# List of versioned datasets for a collection
#
    conf:dataset [
        # SPARQL endpoint URL of the dataset
        conf:sparqlEndpoint "default";
        # Default graph name to query (not necessary for most endpoints)
        # conf:sparqlDefaultGraph <http://141.20.126.155/api/file/50b8c6d228f37c3d62000007/data>;
        # Common URI prefix of all resource URIs in the SPARQL dataset
        conf:datasetBase <http://data.dm2e.eu/data/dataset/>;
        conf:datasetURIPattern "([a-z-_]*/[a-z-_]*)$";
        conf:priority "1";
        conf:addSameAsStatements "false";
        # Will be appended to the conf:webBase to form the public
        # resource URIs; if not present, defaults to ""
        conf:webResourcePrefix "dataset/";
        # conf:customRedirect "de.fuberlin.wiwiss.pubby.dm2e.ResourceRedirector";
        # Will be appended to the conf:webBase to form the public
        # data URIs; if not present, defaults to "data/"
        conf:webDataPrefix "rdf/dataset/";
        # Will be appended to the conf:webBase to form the public
        # page URIs; if not present, defaults to "page/"
        conf:webPagePrefix "html/dataset/";

        conf:useSparqlMapping [
                    conf:uriPattern "http://data.dm2e.eu/data/dataset/([a-z-_]*/[a-z-_]*)$";
                    conf:sparqlQuery '''CONSTRUCT {
                           ?collection a <http://onto.dm2e.eu/schemas/dm2e/AbstractDataset> .
                           ?collection <http://onto.dm2e.eu/schemas/dm2e/hasVersion> ?versionedDataset .
                         } WHERE {
                           GRAPH ?versionedDataset {
                             ?versionedDataset <http://www.w3.org/ns/prov#specializationOf> ?collection .
                             FILTER EXISTS {
                               ?cho a <http://www.europeana.eu/schemas/edm/ProvidedCHO> . 
                             }
                           }
                         } ''';
                    conf:publishResources
                        "http://data.dm2e.eu/data/dataset/$1";
                    conf:primaryResource
                        "http://data.dm2e.eu/data/dataset/$1";
                ];

        # Fixes an issue with the server running behind an Apache proxy;
        # can be ignored otherwise
        conf:fixUnescapedCharacters "(),'!$&*+;=@";

        # include metadata
        conf:metadataTemplate "metadata.ttl";

        # configure your metadata here
        # Use properties with the meta: prefix where the property name
        # corresponds to the placeholder URIs in metadata.ttl that begin
        # with about:metadata:metadata:
        # Examples for such properties are:
#        meta:pubbyUser <URI of the data publisher who uses this Pubby>;
#        meta:pubbyOperator <URI of the service provider who operates this Pubby>;
#        meta:endpointUser <URI of the data publisher who uses the SPARQL endpoint queried by this Pubby>;
#        meta:endpointOperator <URI of the service provider who operates the SPARQL endpoint>;
#        meta:endpointDataset <URI of the linked dataset that is exposed via the SPARQL endpoint>;
    ];

# List of versioned datasets for a Linkset!!
#
    conf:dataset [
        # SPARQL endpoint URL of the dataset
        conf:sparqlEndpoint "default";
        # Default graph name to query (not necessary for most endpoints)
        # conf:sparqlDefaultGraph <http://141.20.126.155/api/file/50b8c6d228f37c3d62000007/data>;
        # Common URI prefix of all resource URIs in the SPARQL dataset
        conf:datasetBase <http://data.dm2e.eu/data/linkset/>;
        conf:datasetURIPattern "([a-z-_]*/[a-z-_]*)$";
        conf:priority "1";
        conf:addSameAsStatements "false";
        # Will be appended to the conf:webBase to form the public
        # resource URIs; if not present, defaults to ""
        conf:webResourcePrefix "linkset/";
        # conf:customRedirect "de.fuberlin.wiwiss.pubby.dm2e.ResourceRedirector";
        # Will be appended to the conf:webBase to form the public
        # data URIs; if not present, defaults to "data/"
        conf:webDataPrefix "rdf/linkset/";
        # Will be appended to the conf:webBase to form the public
        # page URIs; if not present, defaults to "page/"
        conf:webPagePrefix "html/linkset/";

        conf:useSparqlMapping [
                    conf:uriPattern "http://data.dm2e.eu/data/linkset/([a-z-_]*/[a-z-_]*)$";
                    conf:sparqlQuery '''CONSTRUCT {
                           ?collection a <http://onto.dm2e.eu/schemas/dm2e/AbstractLinkset> .
                           ?collection <http://onto.dm2e.eu/schemas/dm2e/hasVersion> ?versionedDataset .
                         } WHERE {
                           GRAPH ?versionedDataset {
                             ?versionedDataset <http://www.w3.org/ns/prov#specializationOf> ?collection .
                           }
                         } ''';
                    conf:publishResources
                        "http://data.dm2e.eu/data/linkset/$1";
                    conf:primaryResource
                        "http://data.dm2e.eu/data/linkset/$1";
                ];

        # Fixes an issue with the server running behind an Apache proxy;
        # can be ignored otherwise
        conf:fixUnescapedCharacters "(),'!$&*+;=@";

        # include metadata
        conf:metadataTemplate "metadata.ttl";

        # configure your metadata here
        # Use properties with the meta: prefix where the property name
        # corresponds to the placeholder URIs in metadata.ttl that begin
        # with about:metadata:metadata:
        # Examples for such properties are:
#        meta:pubbyUser <URI of the data publisher who uses this Pubby>;
#        meta:pubbyOperator <URI of the service provider who operates this Pubby>;
#        meta:endpointUser <URI of the data publisher who uses the SPARQL endpoint queried by this Pubby>;
#        meta:endpointOperator <URI of the service provider who operates the SPARQL endpoint>;
#        meta:endpointDataset <URI of the linked dataset that is exposed via the SPARQL endpoint>;
    ];

# Latest Redirect
#
    conf:dataset [
        # SPARQL endpoint URL of the dataset
        conf:sparqlEndpoint "default";
        # Default graph name to query (not necessary for most endpoints)
        # conf:sparqlDefaultGraph <http://141.20.126.155/api/file/50b8c6d228f37c3d62000007/data>;
        # Common URI prefix of all resource URIs in the SPARQL dataset
        conf:datasetBase <http://data.dm2e.eu/data/dataset/>;
        conf:datasetURIPattern "([a-z-_]*/[a-z-_]*/latest)$";
        conf:priority "1";
        conf:addSameAsStatements "false";
        # Will be appended to the conf:webBase to form the public
        # resource URIs; if not present, defaults to ""
        conf:webResourcePrefix "dataset/";
        conf:customRedirect "de.fuberlin.wiwiss.pubby.dm2e.LatestRedirector";
        # Will be appended to the conf:webBase to form the public
        # data URIs; if not present, defaults to "data/"
        # conf:webDataPrefix "rdf/dataset/";
        # Will be appended to the conf:webBase to form the public
        # page URIs; if not present, defaults to "page/"
        # conf:webPagePrefix "html/dataset/";

    ];




# List of toplevel CHOs in a versioned dataset
#
    conf:dataset [
        # SPARQL endpoint URL of the dataset
        conf:sparqlEndpoint "default";
        # Default graph name to query (not necessary for most endpoints)
        # conf:sparqlDefaultGraph <http://141.20.126.155/api/file/50b8c6d228f37c3d62000007/data>;
        # Common URI prefix of all resource URIs in the SPARQL dataset
        conf:datasetBase <http://data.dm2e.eu/data/dataset/>;
        conf:datasetURIPattern "([a-z-_]*/[a-z-_]*/.*)$";
        conf:priority "2";
        conf:addSameAsStatements "false";
        # Will be appended to the conf:webBase to form the public
        # resource URIs; if not present, defaults to ""
        conf:webResourcePrefix "dataset/";
        # conf:customRedirect "de.fuberlin.wiwiss.pubby.dm2e.ResourceRedirector";
        # Will be appended to the conf:webBase to form the public
        # data URIs; if not present, defaults to "data/"
        conf:webDataPrefix "rdf/dataset/";
        # Will be appended to the conf:webBase to form the public
        # page URIs; if not present, defaults to "page/"
        conf:webPagePrefix "html/dataset/";

        conf:useSparqlMapping [
                    conf:uriPattern "http://data.dm2e.eu/data/dataset/([a-z-_]*/[a-z-_]*/[0-9]*)$";
                    conf:sparqlQuery '''CONSTRUCT {
                           <http://data.dm2e.eu/data/dataset/$1> a <http://onto.dm2e.eu/schemas/dm2e/VersionedDataset> .
                           <http://data.dm2e.eu/data/dataset/$1> <http://onto.dm2e.eu/schemas/dm2e/containsCHO> ?cho .
                           <http://data.dm2e.eu/data/dataset/$1> ?p ?o .
                         } WHERE {
                           GRAPH <http://data.dm2e.eu/data/dataset/$1> {
                               <http://data.dm2e.eu/data/dataset/$1> ?p ?o .
                               ?agg <http://onto.dm2e.eu/schemas/dm2e/displayLevel> "true"^^<http://www.w3.org/2001/XMLSchema#boolean> .
                               ?agg <http://www.europeana.eu/schemas/edm/aggregatedCHO> ?cho .
                           }.
                         } ''';
                    conf:publishResources
                        "http://data.dm2e.eu/data/dataset/$1";
                    conf:primaryResource
                        "http://data.dm2e.eu/data/dataset/$1";
                ];

        # Fixes an issue with the server running behind an Apache proxy;
        # can be ignored otherwise
        conf:fixUnescapedCharacters "(),'!$&*+;=@";

        # include metadata
        conf:metadataTemplate "metadata.ttl";

        # configure your metadata here
        # Use properties with the meta: prefix where the property name
        # corresponds to the placeholder URIs in metadata.ttl that begin
        # with about:metadata:metadata:
        # Examples for such properties are:
#        meta:pubbyUser <URI of the data publisher who uses this Pubby>;
#        meta:pubbyOperator <URI of the service provider who operates this Pubby>;
#        meta:endpointUser <URI of the data publisher who uses the SPARQL endpoint queried by this Pubby>;
#        meta:endpointOperator <URI of the service provider who operates the SPARQL endpoint>;
#        meta:endpointDataset <URI of the linked dataset that is exposed via the SPARQL endpoint>;
    ];


# Resourcemap redirect for item(CHO) and aggregation
#
    conf:dataset [
        # SPARQL endpoint URL of the dataset
        conf:sparqlEndpoint "default";
        # Default graph name to query (not necessary for most endpoints)
        # conf:sparqlDefaultGraph <http://141.20.126.155/api/file/50b8c6d228f37c3d62000007/data>;
        # Common URI prefix of all resource URIs in the SPARQL dataset
        conf:datasetBase <http://data.dm2e.eu/data/>;
        conf:datasetURIPattern "(aggregation|item)/(.*)$";
        conf:priority "2";
        conf:addSameAsStatements "false";
        # Will be appended to the conf:webBase to form the public
        # resource URIs; if not present, defaults to ""
        conf:webResourcePrefix "";
        conf:customRedirect "de.fuberlin.wiwiss.pubby.dm2e.ResourceRedirector";
        # Will be appended to the conf:webBase to form the public
        # data URIs; if not present, defaults to "data/"
        # conf:webDataPrefix "rdf/resourcemap/";
        # Will be appended to the conf:webBase to form the public
        # page URIs; if not present, defaults to "page/"
        # conf:webPagePrefix "html/resourcemap/";

        conf:useSparqlMapping [
                    conf:uriPattern "http://data.dm2e.eu/data/(item|aggregation)/(.*)";
                    conf:sparqlQuery '''CONSTRUCT {
                        ?s ?p ?o .
			?s a <http://example.org/NEVER> .
                    } WHERE {
                        GRAPH ?g {
                        ?s ?p ?o .
                        }
                        FILTER (
                            ?s = <http://data.dm2e.eu/data/item/$2> ||  ?o = <http://data.dm2e.eu/data/item/$2>
                         || ?s = <http://data.dm2e.eu/data/aggregation/$2> ||  ?o = <http://data.dm2e.eu/data/aggregation/$2>
                       )
                    } ''';
                    conf:publishResources
                        "http://data.dm2e.eu/data/aggregation/$2", "http://data.dm2e.eu/data/item/$2";
                    conf:primaryResource
                        "http://data.dm2e.eu/data/item/$2";
                ];

        # Fixes an issue with the server running behind an Apache proxy;
        # can be ignored otherwise
        conf:fixUnescapedCharacters "(),'!$&*+;=@";

        # include metadata
        conf:metadataTemplate "metadata.ttl";

        # configure your metadata here
        # Use properties with the meta: prefix where the property name
        # corresponds to the placeholder URIs in metadata.ttl that begin
        # with about:metadata:metadata:
        # Examples for such properties are:
#        meta:pubbyUser <URI of the data publisher who uses this Pubby>;
#        meta:pubbyOperator <URI of the service provider who operates this Pubby>;
#        meta:endpointUser <URI of the data publisher who uses the SPARQL endpoint queried by this Pubby>;
#        meta:endpointOperator <URI of the service provider who operates the SPARQL endpoint>;
#        meta:endpointDataset <URI of the linked dataset that is exposed via the SPARQL endpoint>;
    ];


# Resourcemap implementation for item(CHO) and aggregation
#
    conf:dataset [
        # SPARQL endpoint URL of the dataset
        conf:sparqlEndpoint "default";
        # Default graph name to query (not necessary for most endpoints)
        # conf:sparqlDefaultGraph <http://141.20.126.155/api/file/50b8c6d228f37c3d62000007/data>;
        # Common URI prefix of all resource URIs in the SPARQL dataset
        conf:datasetBase <http://data.dm2e.eu/data/rdf/resourcemap/>;
        # conf:datasetURIPattern "(aggregation|item)/(.*)$";
        conf:priority "2";
        conf:addSameAsStatements "false";
        # Will be appended to the conf:webBase to form the public
        # resource URIs; if not present, defaults to ""
        conf:webResourcePrefix "rdf/resourcemap/";
        # conf:customRedirect "de.fuberlin.wiwiss.pubby.dm2e.ResourceRedirector";
        # Will be appended to the conf:webBase to form the public
        # data URIs; if not present, defaults to "data/"
        conf:webDataPrefix "rdf/resourcemap/";
        # Will be appended to the conf:webBase to form the public
        # page URIs; if not present, defaults to "page/"
        conf:webPagePrefix "html/resourcemap/";

        conf:useSparqlMapping [
                    conf:uriPattern "http://data.dm2e.eu/data/rdf/resourcemap/([a-z-_]*)/([a-z-_]*)/(.*)/([0-9]*)";
                    conf:sparqlQuery '''CONSTRUCT {
                        <http://data.dm2e.eu/data/item/$1/$2/$3> ?choPredicate ?choObject .
                        ?reveserChoSubject ?reverseChoPredicate <http://data.dm2e.eu/data/item/$1/$2/$3> .
                        # ?reverseChoSubject <http://www.w3.org/1999/02/22-rdf-syntax-ns#type> ?reverseChoSubjectType .

                        <http://data.dm2e.eu/data/aggregation/$1/$2/$3> ?aggPredicate ?aggObject .
                        ?reverseAggSubject ?reverseAggPredicate <http://data.dm2e.eu/data/aggregation/$1/$2/$3> .
                        # ?reverseAggSubject <http://www.w3.org/1999/02/22-rdf-syntax-ns#type> ?reverseAggSubjectType .

                        ?webResourceVersionSubject ?webResourceVersionPredicate ?webResourceVersionObject .
                        ?contextualSubject ?contextualPredicate ?contextualObject .
                        ?containedCho <http://purl.org/dc/terms/isPartOf> <http://data.dm2e.eu/data/item/$1/$2/$3> .
                        ?containedCho <http://www.w3.org/1999/02/22-rdf-syntax-ns#type> <http://www.europeana.eu/schemas/edm/ProvidedCHO> .

                        # Backlinks to Dataset
                        <http://data.dm2e.eu/data/item/$1/$2/$3> <http://rdfs.org/ns/void#inDataset> <http://data.dm2e.eu/data/dataset/$1/$2/$4> .
                        <http://data.dm2e.eu/data/aggregation/$1/$2/$3> <http://rdfs.org/ns/void#inDataset> <http://data.dm2e.eu/data/dataset/$1/$2/$4> .
                    } WHERE {
                        GRAPH <http://data.dm2e.eu/data/dataset/$1/$2/$4> {
                            { <http://data.dm2e.eu/data/item/$1/$2/$3> ?choPredicate ?choObject }
                            UNION
                            {
                                ?reveserChoSubject ?reverseChoPredicate <http://data.dm2e.eu/data/item/$1/$2/$3> .
                                # ?reverseChoSubject <http://www.w3.org/1999/02/22-rdf-syntax-ns#type> ?reverseChoSubjectType .
                            }
                            UNION
                            { <http://data.dm2e.eu/data/aggregation/$1/$2/$3> ?aggPredicate ?aggObject }
                            UNION
                            {
                                ?reverseAggSubject ?reverseAggPredicate <http://data.dm2e.eu/data/aggregation/$1/$2/$3> .
                                # ?reverseAggSubject <http://www.w3.org/1999/02/22-rdf-syntax-ns#type> ?reverseAggSubjectType .
                            }
                            UNION 
                            { ?containedCho <http://purl.org/dc/terms/isPartOf> <http://data.dm2e.eu/data/item/$1/$2/$3> .  }
                            UNION
                            {
                                <http://data.dm2e.eu/data/aggregation/$1/$2/$3> 
                                        <http://onto.dm2e.eu/schemas/dm2e/hasAnnotatableVersionAt>
                                    |   <http://www.europeana.eu/schemas/edm/object>
                                    ?webResourceVersionSubject.
                                ?webResourceVersionSubject ?webResourceVersionPredicate ?webResourceVersionObject.
                            }
                            UNION {
                                <http://data.dm2e.eu/data/item/$1/$2/$3> 
                                    # Misc
                                        <http://purl.org/dc/elements/1.1/subject>
                                    |   <http://www.europeana.eu/schemas/edm/hasMet>

                                    # Agents (creator)
                                    |   <http://purl.org/spar/pro/author> 
                                    |   <http://onto.dm2e.eu/schemas/dm2e/writer>
                                    |   <http://purl.org/dc/elements/1.1/creator>
                                    # Agents (contributor)
                                    |   <http://purl.org/dc/elements/1.1/contributor>
                                    |   <http://purl.org/dc/elements/1.1/publisher>
                                    |   <http://purl.org/ontology/bibo/editor>
                                    |   <http://purl.org/spar/pro/printer>
                                    |   <http://purl.org/spar/pro/translator>
                                    |   <http://purl.org/spar/pro/illustrator>
                                    # Agents (other)
                                    |   <http://www.europeana.eu/schemas/edm/wasPresentAt>
                                    |   <http://onto.dm2e.eu/schemas/dm2e/mentioned>
                                    |   <http://onto.dm2e.eu/schemas/dm2e/misattributed>
                                    |   <http://onto.dm2e.eu/schemas/dm2e/owner>
                                    |   <http://onto.dm2e.eu/schemas/dm2e/previousOwner>
                                    |   <http://onto.dm2e.eu/schemas/dm2e/patron>
                                    |   <http://onto.dm2e.eu/schemas/dm2e/principal>
                                    |   <http://onto.dm2e.eu/schemas/dm2e/sponsor>
                                    |   <http://onto.dm2e.eu/schemas/dm2e/wasStudiedBy>
                                    |   <http://onto.dm2e.eu/schemas/dm2e/wasTaughtBy>
                                    |   <http://purl.org/dc/terms/rightsHolder>
                                    |   <http://purl.org/ontology/bibo/recipient>

                                    # TimeSpan
                                    |   <http://purl.org/dc/terms/created>
                                    |   <http://purl.org/dc/terms/issued>
                                    |   <http://purl.org/dc/terms/temporal>

                                    # Places
                                    |   <http://onto.dm2e.eu/schemas/dm2e/printedAt>
                                    |   <http://onto.dm2e.eu/schemas/dm2e/publishedAt>
                                    |   <http://onto.dm2e.eu/schemas/dm2e/writtenAt>
                                    |   <http://www.europeana.eu/schemas/edm/currentLocation>
                                    ?contextualSubject .
                                ?contextualSubject ?contextualPredicate ?contextualObject .
                            }
                        }
                    } ''';
                    conf:publishResources
                        "http://data.dm2e.eu/data/aggregation/$1/$2/$3", "http://data.dm2e.eu/data/item/$1/$2/$3";
                    conf:primaryResource
                        "http://data.dm2e.eu/data/item/$1/$2/$3";
                ];

        # Fixes an issue with the server running behind an Apache proxy;
        # can be ignored otherwise
        conf:fixUnescapedCharacters "(),'!$&*+;=@";

        # include metadata
        conf:metadataTemplate "metadata.ttl";

        # configure your metadata here
        # Use properties with the meta: prefix where the property name
        # corresponds to the placeholder URIs in metadata.ttl that begin
        # with about:metadata:metadata:
        # Examples for such properties are:
#        meta:pubbyUser <URI of the data publisher who uses this Pubby>;
#        meta:pubbyOperator <URI of the service provider who operates this Pubby>;
#        meta:endpointUser <URI of the data publisher who uses the SPARQL endpoint queried by this Pubby>;
#        meta:endpointOperator <URI of the service provider who operates the SPARQL endpoint>;
#        meta:endpointDataset <URI of the linked dataset that is exposed via the SPARQL endpoint>;
    ];



# Default for data URIs
#
    conf:dataset [
        # SPARQL endpoint URL of the dataset
        conf:sparqlEndpoint "default";
        # Default graph name to query (not necessary for most endpoints)
        # conf:sparqlDefaultGraph <http://141.20.126.155/api/file/50b8c6d228f37c3d62000007/data>;
        # Common URI prefix of all resource URIs in the SPARQL dataset
        conf:datasetBase <http://data.dm2e.eu/data/>;
        conf:priority "10";
        conf:addSameAsStatements "false";
        # Will be appended to the conf:webBase to form the public
        # resource URIs; if not present, defaults to ""
        conf:webResourcePrefix "";
        # conf:customRedirect "de.fuberlin.wiwiss.pubby.dm2e.ResourceRedirector";
        # Will be appended to the conf:webBase to form the public
        # data URIs; if not present, defaults to "data/"
        conf:webDataPrefix "rdf/";
        # Will be appended to the conf:webBase to form the public
        # page URIs; if not present, defaults to "page/"
        conf:webPagePrefix "html/";

        conf:useSparqlMapping [
                    conf:uriPattern "http://data.dm2e.eu/data/(.*)";
                    conf:sparqlQuery '''CONSTRUCT {
                             <http://data.dm2e.eu/data/$1> ?p1 ?o1.
                             ?cho ?choProp <http://data.dm2e.eu/data/$1> .
                    } WHERE {
                        GRAPH ?g {
                            <http://data.dm2e.eu/data/$1> ?p1 ?o1 .
#                            OPTIONAL {
#                                ?cho ?choProp <http://data.dm2e.eu/data/$1> .
#                                ?agg <http://www.europeana.eu/schemas/edm/aggregatedCHO> ?cho .
#                                ?agg <http://onto.dm2e.eu/schemas/dm2e/displayLevel> "true"^^<http://www.w3.org/2001/XMLSchema#boolean> .
#                            }
                        }
                            # OPTIONAL {
                            #     ?s2 ?p2 <http://data.dm2e.eu/data/$1> . 
                            #     # kba Thu Jan 30 14:39:46 CET 2014
                            #     # This must be faster for OAI so we skip non-top elements
                            #     FILTER NOT EXISTS {
                            #         ?s2 <http://purl.org/dc/terms/isPartOf> ?y .
                            #     }
                            # }
                    } ''';
                    conf:publishResources
                        "http://data.dm2e.eu/data/$1";
                    conf:primaryResource
                        "http://data.dm2e.eu/data/$1";
                ];

        # Fixes an issue with the server running behind an Apache proxy;
        # can be ignored otherwise
        conf:fixUnescapedCharacters "(),'!$&*+;=@";

        # include metadata
        conf:metadataTemplate "metadata.ttl";

        # configure your metadata here
        # Use properties with the meta: prefix where the property name
        # corresponds to the placeholder URIs in metadata.ttl that begin
        # with about:metadata:metadata:
        # Examples for such properties are:
#        meta:pubbyUser <URI of the data publisher who uses this Pubby>;
#        meta:pubbyOperator <URI of the service provider who operates this Pubby>;
#        meta:endpointUser <URI of the data publisher who uses the SPARQL endpoint queried by this Pubby>;
#        meta:endpointOperator <URI of the service provider who operates the SPARQL endpoint>;
#        meta:endpointDataset <URI of the linked dataset that is exposed via the SPARQL endpoint>;
    ];


# All Links for a resource
#
    conf:dataset [
        # SPARQL endpoint URL of the dataset
        conf:sparqlEndpoint "default";
        # Default graph name to query (not necessary for most endpoints)
        # conf:sparqlDefaultGraph <http://141.20.126.155/api/file/50b8c6d228f37c3d62000007/data>;
        # Common URI prefix of all resource URIs in the SPARQL dataset
        conf:datasetBase <http://data.dm2e.eu/data/>;
        conf:datasetURIPattern "all-links/(.*)$";
        conf:priority "3";
        conf:addSameAsStatements "false";
        # Will be appended to the conf:webBase to form the public
        # resource URIs; if not present, defaults to ""
        conf:webResourcePrefix "";
        # conf:customRedirect "de.fuberlin.wiwiss.pubby.dm2e.ResourceRedirector";
        # Will be appended to the conf:webBase to form the public
        # data URIs; if not present, defaults to "data/"
        conf:webDataPrefix "rdf/";
        # Will be appended to the conf:webBase to form the public
        # page URIs; if not present, defaults to "page/"
        conf:webPagePrefix "html/";

        conf:useSparqlMapping [
                    conf:uriPattern "http://data.dm2e.eu/data/all-links/(.*)";
                    conf:sparqlQuery '''CONSTRUCT {
                             <http://data.dm2e.eu/data/$1> owl:sameAs ?o1.
                    } WHERE {
                        GRAPH ?g {
                            <http://data.dm2e.eu/data/$1> owl:sameAs ?o1 .
#                            OPTIONAL {
#                                ?cho ?choProp <http://data.dm2e.eu/data/$1> .
#                                ?agg <http://www.europeana.eu/schemas/edm/aggregatedCHO> ?cho .
#                                ?agg <http://onto.dm2e.eu/schemas/dm2e/displayLevel> "true"^^<http://www.w3.org/2001/XMLSchema#boolean> .
#                            }
                        }
                            # OPTIONAL {
                            #     ?s2 ?p2 <http://data.dm2e.eu/data/$1> . 
                            #     # kba Thu Jan 30 14:39:46 CET 2014
                            #     # This must be faster for OAI so we skip non-top elements
                            #     FILTER NOT EXISTS {
                            #         ?s2 <http://purl.org/dc/terms/isPartOf> ?y .
                            #     }
                            # }
                    } ''';
                    conf:publishResources
                        "http://data.dm2e.eu/data/$1";
                    conf:primaryResource
                        "http://data.dm2e.eu/data/$1";
                ];

        # Fixes an issue with the server running behind an Apache proxy;
        # can be ignored otherwise
        conf:fixUnescapedCharacters "(),'!$&*+;=@";

        # include metadata
        conf:metadataTemplate "metadata.ttl";

        # configure your metadata here
        # Use properties with the meta: prefix where the property name
        # corresponds to the placeholder URIs in metadata.ttl that begin
        # with about:metadata:metadata:
        # Examples for such properties are:
#        meta:pubbyUser <URI of the data publisher who uses this Pubby>;
#        meta:pubbyOperator <URI of the service provider who operates this Pubby>;
#        meta:endpointUser <URI of the data publisher who uses the SPARQL endpoint queried by this Pubby>;
#        meta:endpointOperator <URI of the service provider who operates the SPARQL endpoint>;
#        meta:endpointDataset <URI of the linked dataset that is exposed via the SPARQL endpoint>;
    ];


# All links for a resource from a versioned linkset
# special URI
    conf:dataset [
        # SPARQL endpoint URL of the dataset
        conf:sparqlEndpoint "default";
        # Default graph name to query (not necessary for most endpoints)
        # conf:sparqlDefaultGraph <http://141.20.126.155/api/file/50b8c6d228f37c3d62000007/data>;
        # Common URI prefix of all resource URIs in the SPARQL dataset
        conf:datasetBase <http://data.dm2e.eu/data/>;
        conf:datasetURIPattern "(place|agent|concept)/([a-z-_]*)/([a-z-_]*)/(\\w*[-_]*)/([a-z-_]*)/([a-z-_]*)/([0-9]*)";
        conf:priority "1";
        conf:addSameAsStatements "false";
        # Will be appended to the conf:webBase to form the public
        # resource URIs; if not present, defaults to ""
        conf:webResourcePrefix "";
        # conf:customRedirect "de.fuberlin.wiwiss.pubby.dm2e.ResourceRedirector";
        # Will be appended to the conf:webBase to form the public
        # data URIs; if not present, defaults to "data/"
        conf:webDataPrefix "rdf/";
        # Will be appended to the conf:webBase to form the public
        # page URIs; if not present, defaults to "page/"
        conf:webPagePrefix "html/";
        conf:useSparqlMapping [                        # resource / ls-provider / ls / version
                    #/data/place/onb/abo/Nancy/uma/places-geonames-abo/20140312095216607
                    conf:uriPattern "http://data.dm2e.eu/data/(place|agent|concept)/([a-z-_]*)/([a-z-_]*)/(\\w*[-_]*)/([a-z-_]*)/([a-z-_]*)/([0-9]*)";                    
                    conf:sparqlQuery '''
construct {?s ?p ?o. ?g ?pg ?og. ?sbl ?pbl ?obl. } where {
graph ?g {
?s ?p ?o.
?g ?pg ?og.
filter (?s=<http://data.dm2e.eu/data/$1/$2/$3/$4>)
filter(?g=<http://data.dm2e.eu/data/linkset/$5/$6/$7>)
OPTIONAL { ?sbl ?pbl ?obl. filter (?obl=?o)
}
}
}
                        ''';
                    conf:publishResources
                        "http://data.dm2e.eu/data/$1/$2/$3/$4", "http://data.dm2e.eu/data/linkset/$5/$6/$7";
                    conf:primaryResource
                        "http://data.dm2e.eu/data/$1/$2/$3/$4";
                ];

        # Fixes an issue with the server running behind an Apache proxy;
        # can be ignored otherwise
        conf:fixUnescapedCharacters "(),'!$&*+;=@";

        # include metadata
        conf:metadataTemplate "metadata.ttl";

        # configure your metadata here
        # Use properties with the meta: prefix where the property name
        # corresponds to the placeholder URIs in metadata.ttl that begin
        # with about:metadata:metadata:
        # Examples for such properties are:
#        meta:pubbyUser <URI of the data publisher who uses this Pubby>;
#        meta:pubbyOperator <URI of the service provider who operates this Pubby>;
#        meta:endpointUser <URI of the data publisher who uses the SPARQL endpoint queried by this Pubby>;
#        meta:endpointOperator <URI of the service provider who operates the SPARQL endpoint>;
#        meta:endpointDataset <URI of the linked dataset that is exposed via the SPARQL endpoint>;
    ];


# Contexualisation resource from our data (place/agent/concept)
#
    conf:dataset [
        # SPARQL endpoint URL of the dataset
        conf:sparqlEndpoint "default";
        # Default graph name to query (not necessary for most endpoints)
        # conf:sparqlDefaultGraph <http://141.20.126.155/api/file/50b8c6d228f37c3d62000007/data>;
        # Common URI prefix of all resource URIs in the SPARQL dataset
        conf:datasetBase <http://data.dm2e.eu/data/>;
        conf:datasetURIPattern "(place|agent|concept)/(.*)";
        conf:priority "2";
        conf:addSameAsStatements "false";
        # Will be appended to the conf:webBase to form the public
        # resource URIs; if not present, defaults to ""
        conf:webResourcePrefix "";
        # conf:customRedirect "de.fuberlin.wiwiss.pubby.dm2e.ResourceRedirector";
        # Will be appended to the conf:webBase to form the public
        # data URIs; if not present, defaults to "data/"
        conf:webDataPrefix "rdf/";
        # Will be appended to the conf:webBase to form the public
        # page URIs; if not present, defaults to "page/"
        conf:webPagePrefix "html/";
        conf:escapeURIDelimiters "false";
        #show the oh yeah button
        conf:showOrigin "true";
        #prefix for the overview page of an external URI, e.g. for DBpedia
        conf:externalLinkPrefix "external/";
        #for (external) resources linked via these properties (separated by a comma) the "more button" (links to its overview page) is shown
        conf:externalLinkProperties "http://www.w3.org/2002/07/owl#sameAs";
        conf:orderProperty "http://purl.org/dc/elements/1.1/date";

        conf:useSparqlMapping [                        # resource 
                    conf:uriPattern "http://data.dm2e.eu/data/(place|agent|concept)/(.*)";
                    conf:sparqlQuery '''


construct {?s ?p ?o. ?statUri a <http://www.w3.org/1999/02/22-rdf-syntax-ns#Statement>. ?statUri <http://www.w3.org/1999/02/22-rdf-syntax-ns#subject> ?s. ?statUri <http://www.w3.org/1999/02/22-rdf-syntax-ns#predicate> ?p. ?statUri <http://www.w3.org/2000/01/rdf-schema#object> ?o. ?statUri <http://www.w3.org/1999/02/22-rdf-syntax-ns#seeAlso> ?g. ?statUri <http://www.w3.org/ns/prov#wasGeneratedBy> ?prov. ?statUri <http://www.w3.org/2000/01/rdf-schema#comment> ?comment} where {
select ?s ?p ?o ?prov ?g ?comment (URI(CONCAT(STR(?s),"#",ENCODE_FOR_URI(STR(?o)))) AS ?statUri) {
graph ?g {
?s ?p ?o.
?g <http://www.w3.org/ns/prov#wasGeneratedBy> ?prov.
?g <http://www.w3.org/2000/01/rdf-schema#comment> ?comment.
filter (?s=<http://data.dm2e.eu/data/$1/$2> || ?o=<http://data.dm2e.eu/data/$1/$2>)
}
}
}

                        ''';
                    conf:publishResources
                        "http://data.dm2e.eu/data/$1/$2";
                    conf:primaryResource
                        "http://data.dm2e.eu/data/$1/$2";
                ];

        # Fixes an issue with the server running behind an Apache proxy;
        # can be ignored otherwise
        conf:fixUnescapedCharacters "(),'!$&*+;=@";

        # include metadata
        conf:metadataTemplate "metadata.ttl";

        # configure your metadata here
        # Use properties with the meta: prefix where the property name
        # corresponds to the placeholder URIs in metadata.ttl that begin
        # with about:metadata:metadata:
        # Examples for such properties are:
#        meta:pubbyUser <URI of the data publisher who uses this Pubby>;
#        meta:pubbyOperator <URI of the service provider who operates this Pubby>;
#        meta:endpointUser <URI of the data publisher who uses the SPARQL endpoint queried by this Pubby>;
#        meta:endpointOperator <URI of the service provider who operates the SPARQL endpoint>;
#        meta:endpointDataset <URI of the linked dataset that is exposed via the SPARQL endpoint>;
    ];



# External
#
    conf:dataset [
        # SPARQL endpoint URL of the dataset
        conf:sparqlEndpoint "default";
        # Default graph name to query (not necessary for most endpoints)
        # conf:sparqlDefaultGraph <http://141.20.126.155/api/file/50b8c6d228f37c3d62000007/data>;
        # Common URI prefix of all resource URIs in the SPARQL dataset
        conf:datasetBase <http://>;
        conf:datasetURIPattern "(.*)";
        conf:priority "5";
        conf:addSameAsStatements "false";
        # Will be appended to the conf:webBase to form the public
        # resource URIs; if not present, defaults to ""
        conf:webResourcePrefix "external/";
        # conf:customRedirect "de.fuberlin.wiwiss.pubby.dm2e.ResourceRedirector";
        # Will be appended to the conf:webBase to form the public
        # data URIs; if not present, defaults to "data/"
        conf:webDataPrefix "rdf/external/";
        # Will be appended to the conf:webBase to form the public
        # page URIs; if not present, defaults to "page/"
        conf:webPagePrefix "html/external/";
        conf:escapeURIDelimiters "false";
        conf:noWebTranslation "true";

        conf:useSparqlMapping [                        # resource 
                    conf:uriPattern "^(.*)$";
                    conf:sparqlQuery '''


construct {?o ?p ?s.} where {
graph ?g {
?s ?p ?o.
filter (?o=<$1>)
}
}


                        ''';
                    conf:publishResources
                        "$1";
                    conf:primaryResource
                        "$1";
                ];

        # Fixes an issue with the server running behind an Apache proxy;
        # can be ignored otherwise (problems with external URIs!)
        #conf:fixUnescapedCharacters "(),'!$&*+;=@";

        # include metadata
        conf:metadataTemplate "metadata.ttl";

        # configure your metadata here
        # Use properties with the meta: prefix where the property name
        # corresponds to the placeholder URIs in metadata.ttl that begin
        # with about:metadata:metadata:
        # Examples for such properties are:
#        meta:pubbyUser <URI of the data publisher who uses this Pubby>;
#        meta:pubbyOperator <URI of the service provider who operates this Pubby>;
#        meta:endpointUser <URI of the data publisher who uses the SPARQL endpoint queried by this Pubby>;
#        meta:endpointOperator <URI of the service provider who operates the SPARQL endpoint>;
#        meta:endpointDataset <URI of the linked dataset that is exposed via the SPARQL endpoint>;
    ];



# Omnom Data
#
    conf:dataset [
        # SPARQL endpoint URL of the dataset
        conf:sparqlEndpoint <http://localhost:9999/dm2e-omnom/sparql>;
        # Default graph name to query (not necessary for most endpoints)
        # conf:sparqlDefaultGraph <http://141.20.126.155/api/file/50b8c6d228f37c3d62000007/data>;
        # Common URI prefix of all resource URIs in the SPARQL dataset
        conf:datasetBase <http://omnom.dm2e.eu/api/>;
        conf:addSameAsStatements "true";
        # Will be appended to the conf:webBase to form the public
        # resource URIs; if not present, defaults to ""
        conf:webResourcePrefix "omnom/";
        # conf:customRedirect "de.fuberlin.wiwiss.pubby.dm2e.ResourceRedirector";
        # Will be appended to the conf:webBase to form the public
        # data URIs; if not present, defaults to "/data/"
        conf:webDataPrefix "data/omnom/";
        # Will be appended to the conf:webBase to form the public
        # page URIs; if not present, defaults to "page/"
        conf:webPagePrefix "html/omnom/";

        conf:useSparqlMapping [
            conf:uriPattern "http://omnom.dm2e.eu/api/(.*)";
            conf:sparqlQuery '''CONSTRUCT {
                ?s ?p ?o .
            } WHERE {
                GRAPH ?g {
                    ?s ?p ?o .
                }
                FILTER (
                    ?s = <http://omnom.dm2e.eu/api/$1> ||  ?o = <http://omnom.dm2e.eu/api/$1>
                )
            } ''';
            conf:publishResources
                "http://omnom.dm2e.eu/api/$1";
            conf:primaryResource
                "http://omnom.dm2e.eu/api/$1";
        ];

        # Fixes an issue with the server running behind an Apache proxy;
        # can be ignored otherwise
        conf:fixUnescapedCharacters "(),'!$&*+;=@";

        # include metadata
        conf:metadataTemplate "metadata.ttl";

        # configure your metadata here
        # Use properties with the meta: prefix where the property name
        # corresponds to the placeholder URIs in metadata.ttl that begin
        # with about:metadata:metadata:
        # Examples for such properties are:
#        meta:pubbyUser <URI of the data publisher who uses this Pubby>;
#        meta:pubbyOperator <URI of the service provider who operates this Pubby>;
#        meta:endpointUser <URI of the data publisher who uses the SPARQL endpoint queried by this Pubby>;
#        meta:endpointOperator <URI of the service provider who operates the SPARQL endpoint>;
#        meta:endpointDataset <URI of the linked dataset that is exposed via the SPARQL endpoint>;
    ];

# Dataset configuration section #2 (for DBpedia classes and properties)
#
# URIs in the SPARQL endpoint: http://dbpedia.org/class/*
#                              http://dbpedia.org/property/*
# URIs on the Web:             http://localhost:8080/class/*
#                              http://localhost:8080/property/*
#    conf:dataset [
#        conf:sparqlEndpoint <http://lelystad.informatik.uni-mannheim.de:8080/openrdf-workbench/repositories/altedrucke/query>;
#        conf:sparqlDefaultGraph <file://altedrucke.rdf>;
#        conf:datasetBase <file:/home/eckertk/altedrucke/>;
#        # Dataset URIs are mapped only if the part after the
#        # conf:webBase matches this regular expression
#        conf:datasetURIPattern "(class|property)/.*";
#        conf:fixUnescapedCharacters "(),'!$&*+;=@";
#    ];

# vim: set sw=2
    .